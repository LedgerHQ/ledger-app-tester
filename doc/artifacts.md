# Artifacts Internals

This document summarizes what are the different artifacts,
how they are managed,
in which workflows
and what is finally listed and kept.

## Overview

Each internal workflow generate its own set of artifacts.
This simplify the operations, allowing to share data and status between different jobs or workflows.

### Apps Configuration

When getting the list of Apps from GitHub (for both Build or test), we generate a Json data file,
containing all interesting data for each App. Those can be:

- App Name
- Needed SDK (`C` or `Rust`)
- Build directory
- Variant name and values
- ...

The resulting artifact is `apps_config`.

> This artifact is generated by [parse_all_apps.py](../scripts/parse_all_apps.py),
called by [_build_app.yml](../.github/workflows/_build_app.yml).

### Building Operations

During the Build operation, each App is built for all the selected devices.

The generated individual artifacts are

- `build_status_<app_name>.md`: Build status of all selected devices for the concerned App.
- `build_errors_<app_name>.md`: List of failed devices Build operation for the concerned App.

When requested, we also save the generated binaries:

- `binaries_<app_name>`: file tree of the `app.elf` for all selected devices for the concerned App.

> Those artifacts are generated by [build_app.sh](../scripts/build_app.sh),
called by [_build_app.yml](../.github/workflows/_build_app.yml).

### Testing Operations

During the Test operation, the generated artifacts are equivalent to the Build:

- `test_status_<app_name>.md`: Test status of all selected devices for the concerned App.
- `test_errors_<app_name>.md`: List of failed devices Test operation for the concerned App.

> Those artifacts are generated by [test_app.sh](../scripts/test_app.sh),
called by [_test_app.yml](../.github/workflows/_test_app.yml).

## Checking Operations

During the Check operation, the generated artifacts are:

- `check_status_<app_name>.md`: Check status of all selected Apps.
- `check_errors_<app_name>.md`: List of failed Apps.

> Those artifacts are generated by [check_app.sh](../scripts/check_app.sh),
called by [_check_app.yml](../.github/workflows/_check_app.yml).

## Collecting

As seen above, depending on the number of selected Apps, this can lead to a hudge number of files.  
To simplify, and keep minimal data, the are collected into archives, per types.

- Merging the different `xxx_status_<app_name>.md` into a unique archive `xxx_status_all`.
- Merging the different `xxx_errors_<app_name>.md` into a unique archive `xxx_errors_all`.
- Merging the different `binaries_<app_name>` into a unique archive `binaries_all`.

Where `xxx` can be `build`, `test`, or `check`.

> These operations are done by [_artifacts.yml](../.github/workflows/_artifacts.yml).

## Apps Errors

In case of errors when Building or Scanning operations, the file `apps_errors.md`
is generated during the summary report preparation (concatenating all error individual files).  
This file is then uploaded as an artifact `apps_errors`, and will be used to generate the Slack message

> This operation is done by [summary.py](../scripts/summary.py),
called by [_status.yml](../.github/workflows/_status.yml).
